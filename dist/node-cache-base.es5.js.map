{"version":3,"file":"node-cache-base.es5.js","sources":["../src/core/cachecore.ts","../src/node-cache-base.ts"],"sourcesContent":["interface Record {\r\n  value: any\r\n  expire: number\r\n}\r\n\r\nexport default class Cache {\r\n  size: number\r\n  _debug: boolean\r\n  cache: any\r\n  hitCount: number\r\n  missCount: number\r\n  maxSize: number\r\n  constructor(maxSize = 10000) {\r\n    this.size = 0\r\n    this._debug = false\r\n    this.cache = Object.create(null)\r\n    this.hitCount = 0\r\n    this.missCount = 0\r\n    this.maxSize = maxSize\r\n  }\r\n  set = (key: string, value: any, time: number): any => {\r\n    if (\r\n      typeof time !== 'undefined' &&\r\n      (typeof time !== 'number' || isNaN(time) || time <= 0)\r\n    ) {\r\n      throw new Error('Cache timeout must be a positive number')\r\n    }\r\n    if (this.size === this.maxSize) {\r\n      this.clear()\r\n    }\r\n    const record: Record = {\r\n      value: value,\r\n      expire: time + Date.now()\r\n    }\r\n    this.cache[key] = record\r\n    this.size++\r\n    return value\r\n  };\r\n\r\n  del = (key: string): boolean => {\r\n    let isDelete = true\r\n    const oldRecord: Record = this.cache[key]\r\n    if (oldRecord) {\r\n      isDelete = true\r\n    } else {\r\n      isDelete = false\r\n    }\r\n    if (isDelete) {\r\n      this.doDel(key)\r\n    }\r\n\r\n    return isDelete\r\n  }\r\n\r\n  doDel = (key: string): void => {\r\n    this.size--\r\n    delete this.cache[key]\r\n  }\r\n\r\n  clear = (): void => {\r\n    this.size = 0\r\n    this.cache = Object.create(null)\r\n  }\r\n\r\n  get = (key: string): any => {\r\n    const record: Record = this.cache[key]\r\n    if (typeof record != 'undefined') {\r\n      if (isNaN(record.expire) || record.expire >= Date.now()) {\r\n        if (this._debug) this.hitCount++\r\n        return record.value\r\n      } else {\r\n        // free some space\r\n        if (this._debug) this.missCount++\r\n        this.size--\r\n        delete this.cache[key]\r\n      }\r\n    } else if (this._debug) {\r\n      this.missCount++\r\n    }\r\n    return null\r\n  };\r\n\r\n  getSize = (): number => {\r\n    return this.size\r\n  }\r\n\r\n  outputJson = (): string => {\r\n    const result: any = Object.create(null)\r\n    for (let key in this.cache) {\r\n      const record: Record = this.cache[key]\r\n      if (record) {\r\n        result[key] = {\r\n          value: record.value,\r\n          expire: record.expire || null\r\n        }\r\n      }\r\n    }\r\n    return JSON.stringify(result)\r\n  }\r\n\r\n  loadJson = (jsonStr: string, filters: Array<string>): void => {\r\n    const data: any = JSON.parse(jsonStr)\r\n    const time: number = Date.now()\r\n    for (let key in data) {\r\n      if (!data.hasOwnProperty(key) || filters.includes(key)) {\r\n        continue\r\n      }\r\n      const record: Record = data[key]\r\n      const expire: number = record.expire;\r\n      const remaining: number = record.expire - time\r\n      const expireisNull = (!expire && typeof expire != \"undefined\" && expire !=0) \r\n      if (remaining <= 0 || expireisNull) {\r\n        continue\r\n      }\r\n      this.set(key, record.value, remaining)\r\n    }\r\n  }\r\n}\r\n","import Cache from './core/cachecore'\r\n\r\nexport default {\r\n  Cache: Cache\r\n}\r\n"],"names":[],"mappings":"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"}